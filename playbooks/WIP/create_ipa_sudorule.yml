---
- name: create or update a sudo rule in our freeipa instance
  hosts: "{{ all | default('ipaserver') }}"
  become: false
  vars_files: ../vault.yml
  tasks:
    - name: Create or update an ipa sudo rule
      ipasudorule:
        ipaadmin_principal: "{{ idm_ops_admin_username | default(omit) }}"
        ipaadmin_password: "{{ ipa_admin_password }}"
        name: "{{ ipa_sudo_rule }}"
        allow_sudocmdgroup: "{{ ipa_sudo_cmd_group }}"
        group: "{{ ipa_group_name }}"
        hostgroup: "{{ ipa_hbac_hostgroup_name }}"
        runasusercategory: "all"
        runasgroupcategory: "all"